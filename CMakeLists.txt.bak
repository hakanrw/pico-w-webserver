cmake_minimum_required(VERSION 3.13)

# initialize the SDK directly
set(PICO_BOARD pico_w)
include($ENV{PICO_SDK_PATH}/pico_sdk_init.cmake)
# Pull in FreeRTOS
include($ENV{FREERTOS_KERNEL_PATH}/portable/ThirdParty/GCC/RP2040/FreeRTOS_Kernel_import.cmake)

project(webserver C CXX ASM)

# initialize the Raspberry Pi Pico SDK
pico_sdk_init()

# rest of your project
#set(FREERTOS_SRCS $ENV{FREERTOS_KERNEL_PATH}/portable/MemMang/heap_4.c $ENV{FREERTOS_KERNEL_PATH}/portable/ThirdParty/GCC/RP2040/port.c $ENV{FREERTOS_KERNEL_PATH}/croutine.c $ENV{FREERTOS_KERNEL_PATH}/event_groups.c $ENV{FREERTOS_KERNEL_PATH}/list.c $ENV{FREERTOS_KERNEL_PATH}/queue.c $ENV{FREERTOS_KERNEL_PATH}/stream_buffer.c $ENV{FREERTOS_KERNEL_PATH}/tasks.c $ENV{FREERTOS_KERNEL_PATH}/timers.c)
#set(FREERTOS_INCLUDE $ENV{FREERTOS_KERNEL_PATH}/portable/ThirdParty/GCC/RP2040/include $ENV{FREERTOS_KERNEL_PATH}/include)

set(WIFI_SSID my_wifi)
set(WIFI_PASSWORD my_password)

#add_definitions(-DWIFI_SSID="${WIFI_SSID}")
#add_definitions(-DWIFI_PASSWORD="${WIFI_PASSWORD}")
#add_definitions(-DCFG_TUSB_DEBUG=0 -DCFG_TUSB_MCU=OPT_MCU_RP2040 -DCFG_TUSB_OS=OPT_OS_PICO -DCYW43_LWIP=1 -DFREERTOS_KERNEL_SMP=0 -DLIB_FREERTOS_KERNEL=1 -DLIB_PICO_BIT_OPS=1 -DLIB_PICO_BIT_OPS_PICO=1 -DLIB_PICO_CYW43_ARCH=1 -DLIB_PICO_DIVIDER=1 -DLIB_PICO_DIVIDER_HARDWARE=1 -DLIB_PICO_DOUBLE=1 -DLIB_PICO_DOUBLE_PICO=1 -DLIB_PICO_FIX_RP2040_USB_DEVICE_ENUMERATION=1 -DLIB_PICO_FLOAT=1 -DLIB_PICO_FLOAT_PICO=1 -DLIB_PICO_INT64_OPS=1 -DLIB_PICO_INT64_OPS_PICO=1 -DLIB_PICO_MALLOC=1 -DLIB_PICO_MEM_OPS=1 -DLIB_PICO_MEM_OPS_PICO=1 -DLIB_PICO_PLATFORM=1 -DLIB_PICO_PRINTF=1 -DLIB_PICO_PRINTF_PICO=1 -DLIB_PICO_RUNTIME=1 -DLIB_PICO_STANDARD_LINK=1 -DLIB_PICO_STDIO=1 -DLIB_PICO_STDIO_UART=1 -DLIB_PICO_STDIO_USB=1 -DLIB_PICO_STDLIB=1 -DLIB_PICO_SYNC=1 -DLIB_PICO_SYNC_CORE=1 -DLIB_PICO_SYNC_CRITICAL_SECTION=1 -DLIB_PICO_SYNC_MUTEX=1 -DLIB_PICO_SYNC_SEM=1 -DLIB_PICO_TIME=1 -DLIB_PICO_UNIQUE_ID=1 -DLIB_PICO_UTIL=1 -DLWIP_PROVIDE_ERRNO=1 -DLWIP_SOCKET=1 -DMG_ARCH=MG_ARCH_FREERTOS -DMG_ENABLE_LWIP=1 -DMG_ENABLE_PACKED_FS=1 -DNO_SYS=0 -DPICO_BOARD="pico_w" -DPICO_BUILD=1 -DPICO_CMAKE_BUILD_TYPE="Release" -DPICO_CONFIG_RTOS_ADAPTER_HEADER=$ENV{FREERTOS_KERNEL_PATH}/portable/ThirdParty/GCC/RP2040/include/freertos_sdk_config.h -DPICO_COPY_TO_RAM=0 -DPICO_CXX_ENABLE_EXCEPTIONS=0 -DPICO_CYW43_ARCH_FREERTOS=1 -DPICO_NO_FLASH=0 -DPICO_NO_HARDWARE=0 -DPICO_ON_DEVICE=1 -DPICO_USE_BLOCKED_RAM=0 -DWIFI_PASSWORD="${WIFI_PASSWORD}" -DWIFI_SSID="${WIFI_SSID}" -DHTTP_URL="http://0.0.0.0")
#add_definitions(-DWIFI_PASSWORD="${WIFI_PASSWORD}" -DWIFI_SSID="${WIFI_SSID}" -DHTTP_URL="http://0.0.0.0" -DPICO_CONFIG_RTOS_ADAPTER_HEADER=$ENV{FREERTOS_KERNEL_PATH}/portable/ThirdParty/GCC/RP2040/include/freertos_sdk_config.h -DMG_ARCH=MG_ARCH_FREERTOS -DFREERTOS_KERNEL_SMP=0 -DLIB_FREERTOS_KERNEL=1 -DLWIP_SOCKET=1 -DCYW43_LWIP=1 -DCFG_TUSB_MCU=OPT_MCU_RP2040 -DCFG_TUSB_OS=OPT_OS_PICO)
#add_definitions(-DFREERTOS_KERNEL_SMP=0 -DLIB_FREERTOS_KERNEL=1 -DLIB_PICO_BIT_OPS=1 -DLIB_PICO_BIT_OPS_PICO=1 -DLIB_PICO_CYW43_ARCH=1 -DLIB_PICO_DIVIDER=1 -DLIB_PICO_DIVIDER_HARDWARE=1 -DLIB_PICO_DOUBLE=1 -DLIB_PICO_DOUBLE_PICO=1 -DLIB_PICO_FIX_RP2040_USB_DEVICE_ENUMERATION=1 -DLIB_PICO_FLOAT=1 -DLIB_PICO_FLOAT_PICO=1 -DLIB_PICO_INT64_OPS=1 -DLIB_PICO_INT64_OPS_PICO=1 -DLIB_PICO_MALLOC=1 -DLIB_PICO_MEM_OPS=1 -DLIB_PICO_MEM_OPS_PICO=1 -DLIB_PICO_PLATFORM=1 -DLIB_PICO_PRINTF=1 -DLIB_PICO_PRINTF_PICO=1 -DLIB_PICO_RUNTIME=1 -DLIB_PICO_STANDARD_LINK=1 -DLIB_PICO_STDIO=1 -DLIB_PICO_STDIO_UART=1 -DLIB_PICO_STDIO_USB=1 -DLIB_PICO_STDLIB=1 -DLIB_PICO_SYNC=1 -DLIB_PICO_SYNC_CORE=1 -DLIB_PICO_SYNC_CRITICAL_SECTION=1 -DLIB_PICO_SYNC_MUTEX=1 -DLIB_PICO_SYNC_SEM=1 -DLIB_PICO_TIME=1 -DLIB_PICO_UNIQUE_ID=1 -DLIB_PICO_UTIL=1 -DLWIP_PROVIDE_ERRNO=1 -DLWIP_SOCKET=1 -DMG_ARCH=MG_ARCH_FREERTOS -DMG_ENABLE_LWIP=1 -DMG_ENABLE_PACKED_FS=1 -DNO_SYS=0 -DPICO_BOARD="pico_w" -DWIFI_PASSWORD="${WIFI_PASSWORD}" -DWIFI_SSID="${WIFI_SSID}" -DHTTP_URL="http://0.0.0.0")
#add_definitions(-DFREERTOS_KERNEL_SMP=0 -DLIB_FREERTOS_KERNEL=1 -DLIB_PICO_BIT_OPS=1 -DLIB_PICO_BIT_OPS_PICO=1 -DLIB_PICO_CYW43_ARCH=1 -DLIB_PICO_DIVIDER=1 -DLIB_PICO_DIVIDER_HARDWARE=1 -DLIB_PICO_DOUBLE=1 -DLIB_PICO_DOUBLE_PICO=1 -DLWIP_SOCKET=1 -DMG_ARCH=MG_ARCH_FREERTOS -DMG_ENABLE_LWIP=1 -DMG_ENABLE_PACKED_FS=1 -DNO_SYS=0 -DPICO_BOARD="pico_w" -DWIFI_PASSWORD="${WIFI_PASSWORD}" -DWIFI_SSID="${WIFI_SSID}" -DHTTP_URL="http://0.0.0.0")
#add_definitions(-DLWIP_SOCKET=1 -DMG_ARCH=MG_ARCH_FREERTOS -DMG_ENABLE_LWIP=1 -DMG_ENABLE_PACKED_FS=1 -DNO_SYS=0 -DPICO_BOARD="pico_w" -DWIFI_PASSWORD="${WIFI_PASSWORD}" -DWIFI_SSID="${WIFI_SSID}" -DHTTP_URL="http://0.0.0.0")
add_definitions(-DMG_ARCH=MG_ARCH_FREERTOS -DMG_ENABLE_LWIP -DNO_SYS=0 -DPICO_BOARD="pico_w" -DWIFI_PASSWORD="${WIFI_PASSWORD}" -DWIFI_SSID="${WIFI_SSID}" -DHTTP_URL="http://0.0.0.0")

# Add pico_stdlib library which aggregates commonly used features
add_executable(webserver main.c mongoose.c net.c ${FREERTOS_SRCS})

target_include_directories(webserver PUBLIC .)
target_include_directories(webserver PRIVATE ${FREERTOS_INCLUDE})

#target_link_libraries(webserver pico_stdlib pico_stdio pico_cyw43_arch_lwip_poll pico_cyw43_arch_lwip_sys_freertos pico_lwip_mbedtls pico_mbedtls pico_lwip_contrib_freertos pico_lwip_http FreeRTOS-Kernel FreeRTOS-Kernel-Heap4)
#target_link_libraries(webserver pico_stdlib pico_stdio pico_lwip pico_cyw43_arch_lwip_poll pico_cyw43_arch_lwip_sys_freertos FreeRTOS-Kernel FreeRTOS-Kernel-Heap4)
target_link_libraries(webserver pico_stdlib pico_stdio pico_lwip pico_cyw43_arch_lwip_sys_freertos FreeRTOS-Kernel FreeRTOS-Kernel-Heap4)
pico_add_extra_outputs(webserver)
pico_enable_stdio_usb(webserver 1)
